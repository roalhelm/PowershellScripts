# üìä Microsoft Endpoint Connectivity Testing - Technische Dokumentation

## üìã √úbersicht

Dieses Dokument enth√§lt umfassende technische Informationen √ºber die Microsoft Endpoint Connectivity Tests, einschlie√ülich der Datenquellen, Endpoint-URLs, Testmethodiken und technischen Implementierungsdetails.

---

## üéØ Getestete Microsoft Services

### üìä Service-√úbersicht

| Service | Endpoints | Zweck | Kritikalit√§t |
|---------|-----------|--------|--------------|
| **Windows Update for Business** | 16 URLs | System-Updates und Patches | üî¥ Kritisch |
| **Windows Autopatch** | 7 URLs | Automatische Patch-Verwaltung | üü° Hoch |
| **Microsoft Intune** | 13 URLs | Device Management/MDM | üî¥ Kritisch |
| **Microsoft Defender** | 11 URLs | Antivirus und Security | üî¥ Kritisch |
| **Azure Active Directory** | 8 URLs | Identity/Authentication | üî¥ Kritisch |
| **Microsoft 365** | 11 URLs | Produktivit√§ts-Suite | üü° Hoch |
| **Microsoft Store** | 8 URLs | App-Distribution | üü¢ Mittel |
| **Windows Activation** | 6 URLs | Lizenzierung | üü° Hoch |
| **Microsoft Edge** | 6 URLs | Browser-Services | üü¢ Mittel |
| **Windows Telemetry** | 10 URLs | Diagnostik und Monitoring | üü¢ Niedrig |

**Gesamt: 96+ eindeutige Endpoints √ºber 10 Microsoft Service-Kategorien**

---

## üåê Endpoint-Datenquellen und Methodik

### üìö Offizielle Microsoft-Dokumentation

Die Endpoint-URLs werden aus folgenden **offiziellen Microsoft-Quellen** bezogen:

#### üîó Prim√§re Dokumentationsquellen

1. **Microsoft 365 Network Connectivity**
   - URL: https://docs.microsoft.com/en-us/microsoft-365/enterprise/urls-and-ip-address-ranges
   - Verwendung: Microsoft 365, Azure AD, Exchange Online

2. **Windows Update for Business**
   - URL: https://docs.microsoft.com/en-us/windows/deployment/update/waas-wu-settings
   - Verwendung: Windows Update, Delivery Optimization

3. **Microsoft Intune Network Requirements** 
   - URL: https://docs.microsoft.com/en-us/mem/intune/fundamentals/intune-endpoints
   - Verwendung: Intune Management, Enrollment, Compliance

4. **Microsoft Defender for Endpoint**
   - URL: https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-proxy-internet
   - Verwendung: Defender Cloud Services, Threat Intelligence

5. **Azure Active Directory Connect**
   - URL: https://docs.microsoft.com/en-us/azure/active-directory/hybrid/reference-connect-ports
   - Verwendung: Azure AD, Device Registration, Authentication

6. **Microsoft Store for Business**
   - URL: https://docs.microsoft.com/en-us/microsoft-store/prerequisites-microsoft-store-for-business
   - Verwendung: Store Apps, Deployment, Licensing

7. **Windows Activation Services**
   - URL: https://docs.microsoft.com/en-us/windows/deployment/volume-activation/activate-using-key-management-service-vamt
   - Verwendung: KMS, MAK, Digital License Activation

#### üîç Zus√§tzliche Validierungsquellen

8. **Microsoft Edge Enterprise**
   - URL: https://docs.microsoft.com/en-us/deployedge/microsoft-edge-security-endpoints
   - Verwendung: Edge Updates, SmartScreen, Sync Services

9. **Windows Telemetry and Diagnostics**
   - URL: https://docs.microsoft.com/en-us/windows/privacy/configure-windows-diagnostic-data-in-your-organization
   - Verwendung: Diagnostic Data, Watson Error Reporting

10. **Windows Autopatch Documentation**
    - URL: https://docs.microsoft.com/en-us/windows/deployment/windows-autopatch/
    - Verwendung: Automated Patch Management, Device Health

### üîÑ Endpoint-Validierung und Aktualisierung

#### ‚úÖ Validierungsmethodik

1. **Offizielle Dokumentation**: Alle URLs werden gegen Microsoft's offizielle Dokumentation validiert
2. **Network Testing**: Praktische Konnektivit√§tstests in Produktionsumgebungen
3. **Community Feedback**: Validierung durch Enterprise-IT-Communities
4. **Microsoft Support**: Best√§tigung kritischer Endpoints durch Microsoft Support Cases

#### üîÑ Aktualisierungsprozess

- **Quarterly Reviews**: Viertelj√§hrliche √úberpr√ºfung aller Endpoint-Listen
- **Microsoft Documentation Monitoring**: √úberwachung von √Ñnderungen in Microsoft Docs
- **Issue Tracking**: GitHub Issues f√ºr neue/veraltete Endpoints
- **Version Control**: Versionierung aller Endpoint-√Ñnderungen

---

## üèóÔ∏è Technische Implementierung

### üìä Endpoint-Struktur im Script

```powershell
$backendUrls = @{
    'Windows Update for Business' = @(
        'https://dl.delivery.mp.microsoft.com',
        'https://download.windowsupdate.com',
        'https://fe3.delivery.mp.microsoft.com',
        # ... weitere URLs
    ) | Sort-Object -Unique
    
    'Intune' = @(
        'https://device.login.microsoftonline.com',
        'https://endpoint.microsoft.com',
        'https://graph.microsoft.com',
        # ... weitere URLs
    ) | Sort-Object -Unique
    
    # ... weitere Service-Kategorien
}
```

### üîß Testmethodiken

#### 1Ô∏è‚É£ **Konnektivit√§tstest (TCP)**
```powershell
Test-NetConnection -ComputerName $hostname -Port 443 -WarningAction SilentlyContinue
```
- **Zweck**: Grundlegende TCP-Verbindung auf Port 443 (HTTPS)
- **Timeout**: 5 Sekunden pro Endpoint
- **Bewertung**: Erfolg/Fehler bin√§r

#### 2Ô∏è‚É£ **Latenz-Test (Ping)**
```powershell
Test-Connection -ComputerName $hostname -Count 3 -Quiet
```
- **Zweck**: Netzwerk-Latenz und Packet-Loss Messung
- **Metriken**: Min/Max/Durchschnitt Latenz in ms
- **Bewertung**: Exzellent (<50ms), Gut (50-200ms), Verbesserungsbedarf (>200ms)

#### 3Ô∏è‚É£ **Performance-Test (Download)**
```powershell
Measure-Command { Invoke-WebRequest -Uri $url -Method HEAD -TimeoutSec 10 }
```
- **Zweck**: Response-Time und Server-Performance
- **Metriken**: HTTP Response Time in ms
- **Bewertung**: Schnell (<500ms), Normal (500-2000ms), Langsam (>2000ms)

### üé® HTML-Report Generation

#### üìä Report-Struktur
- **Dashboard**: √úbersicht mit Statistiken und Status-Karten
- **Service-Tabellen**: Detaillierte Ergebnisse gruppiert nach Microsoft Services
- **Performance-Charts**: Visuelle Latenz- und Speed-Analysen
- **Impact-Analysis**: Auswirkungen von Verbindungsproblemen

#### üé® Design-Elemente
- **Responsive Layout**: Bootstrap-√§hnliches Grid-System
- **Microsoft Look & Feel**: Offizielle Microsoft-Farben und Fonts
- **Accessibility**: WCAG 2.1 konforme Farbkontraste
- **Mobile-Optimized**: Funktioniert auf allen Ger√§te-Gr√∂√üen

---

## üìã Detaillierte Endpoint-Listen

### üîÑ Windows Update for Business (16 Endpoints)

| URL | Zweck | Kritikalit√§t |
|-----|-------|--------------|
| `dl.delivery.mp.microsoft.com` | Content Delivery Network | Kritisch |
| `download.windowsupdate.com` | Update-Downloads | Kritisch |
| `fe3.delivery.mp.microsoft.com` | Frontend Delivery | Hoch |
| `sws.update.microsoft.com` | Software Update Services | Hoch |
| `update.microsoft.com` | Update-Katalog | Kritisch |
| `windowsupdate.microsoft.com` | Windows Update Client | Kritisch |
| `*.delivery.mp.microsoft.com` | Geo-distributed CDN | Hoch |
| `*.dl.delivery.mp.microsoft.com` | Download CDN | Hoch |
| `*.update.microsoft.com` | Regional Update Services | Hoch |
| `*.windowsupdate.com` | Legacy Update Services | Mittel |
| `*.windowsupdate.microsoft.com` | Regional WU Services | Hoch |

**Ausfallauswirkungen**: Keine Windows Updates, Sicherheitsl√ºcken, veraltete Treiber

### üõ°Ô∏è Microsoft Defender (11 Endpoints)

| URL | Zweck | Kritikalit√§t |
|-----|-------|--------------|
| `*.defender.microsoft.com` | Defender Portal/Console | Hoch |
| `*.security.microsoft.com` | Security Center | Hoch |
| `*.wdcp.microsoft.com` | Windows Defender Cloud Protection | Kritisch |
| `definitionupdates.microsoft.com` | Virus Definition Updates | Kritisch |
| `unitedstates.cp.wd.microsoft.com` | US Cloud Protection | Kritisch |
| `europe.cp.wd.microsoft.com` | EU Cloud Protection | Kritisch |
| `asia.cp.wd.microsoft.com` | Asia Cloud Protection | Kritisch |

**Ausfallauswirkungen**: Veraltete Antivirus-Signaturen, kein Cloud-Schutz, eingeschr√§nkte Threat Detection

### üì± Microsoft Intune (13 Endpoints)

| URL | Zweck | Kritikalit√§t |
|-----|-------|--------------|
| `device.login.microsoftonline.com` | Device Authentication | Kritisch |
| `endpoint.microsoft.com` | Endpoint Manager Portal | Hoch |
| `graph.microsoft.com` | Microsoft Graph API | Kritisch |
| `manage.microsoft.com` | Intune Management Service | Kritisch |
| `portal.manage.microsoft.com` | Intune Admin Portal | Hoch |
| `enrollment.manage.microsoft.com` | Device Enrollment | Kritisch |
| `enterpriseregistration.windows.net` | Azure AD Device Registration | Kritisch |

**Ausfallauswirkungen**: Kein Device Enrollment, App-Deployment schl√§gt fehl, Compliance-Checks funktionieren nicht

### üîê Azure Active Directory (8 Endpoints)

| URL | Zweck | Kritikalit√§t |
|-----|-------|--------------|
| `login.microsoftonline.com` | Azure AD Authentication | Kritisch |
| `device.login.microsoftonline.com` | Device Login | Kritisch |
| `enterpriseregistration.windows.net` | Device Registration | Kritisch |
| `pas.windows.net` | Privileged Access Service | Hoch |
| `management.azure.com` | Azure Resource Manager | Hoch |
| `policykeyservice.dc.ad.msft.net` | Policy Key Service | Hoch |

**Ausfallauswirkungen**: Login-Probleme, Single Sign-On schl√§gt fehl, Device Registration nicht m√∂glich

### üìä Microsoft 365 (11 Endpoints)

| URL | Zweck | Kritikalit√§t |
|-----|-------|--------------|
| `admin.microsoft.com` | Microsoft 365 Admin Center | Hoch |
| `config.office.com` | Office Configuration Service | Hoch |
| `graph.microsoft.com` | Microsoft Graph API | Kritisch |
| `officecdn.microsoft.com` | Office Content Delivery | Hoch |
| `protection.office.com` | Security & Compliance Center | Hoch |
| `portal.office.com` | Office 365 Portal | Mittel |
| `*.office.com` | Office Online Services | Hoch |
| `*.sharepoint.com` | SharePoint Online | Hoch |
| `*.onedrive.com` | OneDrive for Business | Hoch |

**Ausfallauswirkungen**: Office Apps funktionieren nicht vollst√§ndig, OneDrive Sync-Probleme, E-Mail-Zugriff eingeschr√§nkt

---

## üîß Verwendung und Parameter

### üéÆ Interactive Mode (Standard)
```powershell
.\CheckMicrosoftEndpointsV2.ps1
```
Zeigt interaktives Men√º zur Service-Auswahl

### üöÄ All Services mit vollem Report
```powershell
.\CheckMicrosoftEndpointsV2.ps1 -Services All -HtmlReport -OpenReport
```

### ‚ö° Schneller Test kritischer Services
```powershell
.\CheckMicrosoftEndpointsV2.ps1 -Services WindowsUpdate,Intune,Defender,AzureAD -SkipSpeed
```

### ü§ñ Automatisierter Test f√ºr CI/CD
```powershell
.\CheckMicrosoftEndpointsV2.ps1 -Services All -Quiet -HtmlReport "connectivity-report.html"
```

### üìä Selektive Service-Tests
```powershell
# Nur Windows Update und Intune
.\CheckMicrosoftEndpointsV2.ps1 -Services WindowsUpdate,Intune

# Nur Security-relevante Services  
.\CheckMicrosoftEndpointsV2.ps1 -Services Defender,AzureAD

# Nur Office/Produktivit√§t
.\CheckMicrosoftEndpointsV2.ps1 -Services Microsoft365,Edge
```

---

## üé® HTML-Report Features

### üìä Dashboard-Komponenten
- **Service Status Cards**: √úbersicht aller getesteten Services
- **Performance Statistics**: Latenz-/Speed-Metriken
- **Failed Connections Summary**: Problembereiche sofort erkennbar
- **Test Configuration**: Welche Parameter wurden verwendet

### üìã Detaillierte Service-Tabellen
- **Status Badges**: Farbkodierte OK/FAILED Indikatoren
- **IP Resolution**: Aufgel√∂ste IP-Adressen f√ºr Troubleshooting
- **Performance Metrics**: Ping-Latenz und Response-Times (falls aktiviert)
- **Service Grouping**: Logische Gruppierung nach Microsoft Services

### üé® Design-Prinzipien
- **Microsoft Design Language**: Vertraute Optik f√ºr IT-Professionals
- **Responsive Layout**: Funktioniert auf Desktop, Tablet, Mobile
- **Accessibility**: Hohe Kontraste, Screen Reader kompatibel
- **Print-Friendly**: Optimiert f√ºr PDF-Export

---

## üîç Troubleshooting und Diagnostik

### ‚ùå H√§ufige Verbindungsprobleme

#### üî• Firewall/Proxy-Probleme
```
FAILED: Connection timed out
FAILED: Access denied
```
**L√∂sung**: Firewall-Regeln f√ºr HTTPS (443) zu Microsoft Domains pr√ºfen

#### üåê DNS-Resolution-Probleme
```
FAILED: Name resolution failed
```
**L√∂sung**: DNS-Server-Konfiguration und Connectivity pr√ºfen

#### ‚ö° Performance-Probleme
```
OK but slow response (>2000ms)
High ping latency (>200ms)
```
**L√∂sung**: Netzwerk-Latenz und Bandbreite analysieren

### üîß Erweiterte Diagnostik

#### üìã Log-Analyse
```powershell
# Detaillierte Fehlermeldungen aktivieren
$VerbosePreference = 'Continue'
.\CheckMicrosoftEndpointsV2.ps1 -Services All -Verbose
```

#### üåê Netzwerk-Trace
```powershell
# Netzwerk-Trace f√ºr spezifische URLs
netsh trace start capture=yes tracefile=network.etl provider=Microsoft-Windows-TCPIP
# Test ausf√ºhren
netsh trace stop
```

#### üìä Performance-Baseline
```powershell
# Baseline-Report f√ºr Vergleiche erstellen
.\CheckMicrosoftEndpointsV2.ps1 -Services All -HtmlReport "Baseline-$(Get-Date -Format 'yyyy-MM-dd').html"
```

---

## üìà Performance-Metriken und Bewertung

### ‚ö° Latenz-Bewertung (Ping)

| Kategorie | Latenz | Bewertung | Auswirkung |
|-----------|--------|-----------|------------|
| üü¢ **Exzellent** | < 50ms | Optimal | Keine Performance-Einbu√üen |
| üü° **Gut** | 50-200ms | Akzeptabel | Minimale Verz√∂gerungen |
| üî¥ **Verbesserungsbedarf** | > 200ms | Problematisch | Sp√ºrbare Performance-Probleme |

### üöÄ Response-Time-Bewertung (HTTP)

| Kategorie | Response-Time | Bewertung | Auswirkung |
|-----------|---------------|-----------|------------|
| üü¢ **Schnell** | < 500ms | Optimal | Fl√ºssige Nutzererfahrung |
| üü° **Normal** | 500-2000ms | Akzeptabel | Gelegentliche Verz√∂gerungen |
| üî¥ **Langsam** | > 2000ms | Problematisch | Deutliche Performance-Einbu√üen |

### üìä Service-spezifische SLAs

| Service | Acceptable Latenz | Critical Threshold | Business Impact |
|---------|------------------|-------------------|-----------------|
| **Windows Update** | < 100ms | > 500ms | Update-Downloads langsam |
| **Azure AD Login** | < 50ms | > 200ms | Login-Verz√∂gerungen |
| **Intune Management** | < 150ms | > 1000ms | Device Management tr√§ge |
| **Defender Updates** | < 200ms | > 1000ms | Security-Risiko |

---

## üîÑ Automatisierung und Integration

### üìÖ Scheduled Tasks
```powershell
# T√§glicher Connectivity-Check
$action = New-ScheduledTaskAction -Execute "PowerShell.exe" -Argument "-File C:\Scripts\CheckMicrosoftEndpointsV2.ps1 -Services All -Quiet -HtmlReport 'C:\Reports\Daily-Connectivity.html'"
$trigger = New-ScheduledTaskTrigger -Daily -At "06:00"
Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "Daily-Microsoft-Connectivity-Check"
```

### üîÑ CI/CD Integration
```yaml
# Azure DevOps Pipeline Step
- task: PowerShell@2
  displayName: 'Microsoft Endpoint Connectivity Test'
  inputs:
    targetType: 'filePath'
    filePath: '$(System.DefaultWorkingDirectory)/Scripts/CheckMicrosoftEndpointsV2.ps1'
    arguments: '-Services All -Quiet -HtmlReport "$(Agent.TempDirectory)/connectivity-report.html"'
```

### üìä Monitoring Integration
```powershell
# SCOM/PRTG Integration
$exitCode = .\CheckMicrosoftEndpointsV2.ps1 -Services All -Quiet
if ($exitCode -ne 0) {
    # Alert senden
    Send-MonitoringAlert -Message "Microsoft Endpoint Connectivity Issues Detected"
}
```

---

## üõ°Ô∏è Security und Best Practices

### üîí Execution Policy
```powershell
# Sichere Execution Policy f√ºr Scripts
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### üîê Least Privilege Principle
- **Standard User**: Basis-Connectivity-Tests
- **Administrator**: Nicht erforderlich f√ºr Network-Tests
- **Graph API**: Nur f√ºr erweiterte Intune-Diagnostik

### üõ°Ô∏è Firewall-Konfiguration
```powershell
# Windows Firewall Regel f√ºr ausgehende HTTPS-Verbindungen
New-NetFirewallRule -DisplayName "Microsoft Services HTTPS" -Direction Outbound -Protocol TCP -RemotePort 443 -Action Allow
```

---

## üìö Weiterf√ºhrende Ressourcen

### üìñ Offizielle Microsoft Dokumentation
- [Microsoft 365 Network Connectivity Principles](https://docs.microsoft.com/en-us/microsoft-365/enterprise/microsoft-365-network-connectivity-principles)
- [Intune Network Configuration](https://docs.microsoft.com/en-us/mem/intune/fundamentals/intune-endpoints)
- [Windows Update Delivery Optimization](https://docs.microsoft.com/en-us/windows/deployment/update/waas-delivery-optimization)
- [Azure AD Network Requirements](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/reference-connect-ports)

### üîß Tools und Utilities
- [Microsoft Remote Connectivity Analyzer](https://testconnectivity.microsoft.com/)
- [Microsoft 365 Network Assessment Tool](https://connectivity.office.com/)
- [Windows Network Troubleshooter](https://support.microsoft.com/en-us/help/10741/windows-fix-network-connection-issues)

### üè¢ Enterprise Deployment Guides
- [Microsoft 365 Enterprise Deployment Guide](https://docs.microsoft.com/en-us/microsoft-365/enterprise/)
- [Intune Deployment Planning Guide](https://docs.microsoft.com/en-us/mem/intune/fundamentals/planning-guide)
- [Windows 10/11 Enterprise Deployment](https://docs.microsoft.com/en-us/windows/deployment/)

---

## üìÑ Changelog und Versionierung

### Version 2.1 (Aktuell - Oktober 2025)
- ‚ú® **HTML-Report Generation** mit responsivem Design
- üéØ **Service-Selection** Parameter und Interactive Menu  
- ‚ö° **Performance-Optimierungen** mit Skip-Optionen
- üì± **Mobile-Optimized** Reports
- üîç **Enhanced Analytics** und Performance-Statistiken

### Version 2.0 (Oktober 2025)  
- üéÆ **Interactive Menu-System** f√ºr Service-Auswahl
- üìä **Selective Testing** Funktionalit√§t
- üöÄ **Speed Optimizations** durch optionale Tests
- üîá **Quiet Mode** f√ºr Automation

### Version 1.1 (Oktober 2025)
- üèì **Ping Latency Tests** hinzugef√ºgt
- üìà **Download Speed Tests** implementiert  
- üé® **Enhanced Console Output** mit Farben
- üìä **Performance Statistics** und Bewertungen

### Version 1.0 (Oktober 2025)
- üîå **Basic TCP Connectivity Tests** 
- üåê **Comprehensive Service Coverage**
- üéØ **Impact Analysis** f√ºr failed connections
- üìã **Structured Output** nach Service-Kategorien

---

## ‚ö†Ô∏è Microsoft Services Criticality Assessment

| Service | Endpoint Purpose | Criticality | Business Impact on Failure |
|---------|------------------|-------------|---------------------------|
| **Windows Update for Business** | Update Downloads, Catalog Sync, CDN Access | üî¥ **Critical** | No security updates, system vulnerabilities |
| **Microsoft Intune** | Device Management, Policy Sync, App Deployment | üî¥ **Critical** | No MDM, compliance loss, app installations fail |
| **Azure Active Directory** | Authentication, Token Renewal, Device Registration | üî¥ **Critical** | Login issues, SSO failure, device registration blocked |
| **Microsoft Defender** | Threat Intelligence, Cloud Protection, Definition Updates | üü† **High** | Outdated antivirus signatures, limited malware protection |
| **Windows Autopatch** | Automatic Patch Management, Update Orchestration | üü† **High** | Manual update management required, no automated deployments |
| **Microsoft 365** | Office Apps, OneDrive Sync, SharePoint Access | üü† **High** | Office apps limited, sync issues, productivity loss |
| **Windows Activation** | License Validation, KMS Services, Digital License | üü° **Medium** | Activation issues on fresh installs, license warnings |
| **Microsoft Store** | App Downloads, Updates, Deployment | üü° **Medium** | Store apps won't install, update issues with Store apps |
| **Microsoft Edge** | Browser Updates, SmartScreen, Enterprise Services | üü° **Medium** | Browser updates fail, limited security features |
| **Windows Telemetry** | Diagnostic Data, Error Reports, Analytics | üü¢ **Low** | No functional impact, only diagnostic data affected |

### üéØ Criticality Legend

| Symbol | Level | Downtime Tolerance | Action Required |
|--------|-------|-------------------|-----------------|
| üî¥ **Critical** | System-essential | < 1 Hour | Immediate fix required |
| üü† **High** | Business-critical | < 4 Hours | Priority treatment |
| üü° **Medium** | Functionality-impact | < 24 Hours | Planned remediation |
| üü¢ **Low** | Optional/Analytics | > 24 Hours | Fix when convenient |

---

## üë®‚Äçüíª Author & Maintenance

**Entwickelt von**: Ronny Alhelm  
**GitHub**: [@roalhelm](https://github.com/roalhelm)  
**Repository**: [PowershellScripts](https://github.com/roalhelm/PowershellScripts)  
**Lizenz**: GNU General Public License v3.0  

**Letzte Aktualisierung**: Oktober 2025  
**N√§chste Review**: Januar 2026  

---
